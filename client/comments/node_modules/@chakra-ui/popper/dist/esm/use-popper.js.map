{"version":3,"sources":["../../src/use-popper.ts"],"names":["React","createPopper","getArrowStyles","toTransformOrigin","isBrowser","window","useSafeLayoutEffect","useLayoutEffect","useEffect","usePopper","props","placement","initialPlacement","offset","offsetProp","preventOverflow","fixed","forceUpdate","flip","arrowSize","arrowShadowColor","gutter","eventsEnabled","modifiers","popper","useRef","referenceRef","popoverRef","arrowRef","originalPlacement","place","useState","setPlacement","popoverStyles","setPopoverStyles","arrowStyles","setArrowStyles","update","useCallback","current","modifiersOverride","strategy","name","enabled","options","padding","gpuAcceleration","adaptive","tetherOffset","clientWidth","Boolean","element","phase","fn","state","styles","arrow","destroy","id","requestAnimationFrame","cancelAnimationFrame","computedArrowStyles","popperInstance","reference","ref","style","transformOrigin"],"mappings":";;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAAmBC,YAAnB,QAAiD,gBAAjD;AAEA,SAASC,cAAT,EAAyBC,iBAAzB,QAAkD,gBAAlD;AAEA,IAAMC,SAAS,GAAG,OAAOC,MAAP,KAAkB,WAApC;AACA,IAAMC,mBAAmB,GAAGF,SAAS,GAAGJ,KAAK,CAACO,eAAT,GAA2BP,KAAK,CAACQ,SAAtE;AAkBA,OAAO,SAASC,SAAT,CAAmBC,KAAnB,EAA+C;AAAA,MAA5BA,KAA4B;AAA5BA,IAAAA,KAA4B,GAAJ,EAAI;AAAA;;AACpD,MAAM;AACJC,IAAAA,SAAS,EAAEC,gBAAgB,GAAG,QAD1B;AAEJC,IAAAA,MAAM,EAAEC,UAFJ;AAGJC,IAAAA,eAAe,GAAG,IAHd;AAIJC,IAAAA,KAAK,GAAG,KAJJ;AAKJC,IAAAA,WAAW,GAAG,IALV;AAMJC,IAAAA,IAAI,GAAG,IANH;AAOJC,IAAAA,SAAS,GAAG,EAPR;AAQJC,IAAAA,gBARI;AASJC,IAAAA,MAAM,GAAGF,SATL;AAUJG,IAAAA,aAAa,GAAG,IAVZ;AAWJC,IAAAA;AAXI,MAYFb,KAZJ;AAcA,MAAMc,MAAM,GAAGxB,KAAK,CAACyB,MAAN,CAA8B,IAA9B,CAAf;AACA,MAAMC,YAAY,GAAG1B,KAAK,CAACyB,MAAN,CAAgC,IAAhC,CAArB;AACA,MAAME,UAAU,GAAG3B,KAAK,CAACyB,MAAN,CAA6B,IAA7B,CAAnB;AACA,MAAMG,QAAQ,GAAG5B,KAAK,CAACyB,MAAN,CAA6B,IAA7B,CAAjB;AAEA,MAAM,CAACI,iBAAD,EAAoBC,KAApB,IAA6B9B,KAAK,CAAC+B,QAAN,CAAenB,gBAAf,CAAnC;AACA,MAAM,CAACD,SAAD,EAAYqB,YAAZ,IAA4BhC,KAAK,CAAC+B,QAAN,CAAenB,gBAAf,CAAlC;AACA,MAAM,CAACC,MAAD,IAAWb,KAAK,CAAC+B,QAAN,CAAejB,UAAU,IAAI,CAAC,CAAD,EAAIO,MAAJ,CAA7B,CAAjB;AACA,MAAM,CAACY,aAAD,EAAgBC,gBAAhB,IAAoClC,KAAK,CAAC+B,QAAN,CACxC,EADwC,CAA1C;AAGA,MAAM,CAACI,WAAD,EAAcC,cAAd,IAAgCpC,KAAK,CAAC+B,QAAN,CAAoC,EAApC,CAAtC;AAEA,MAAMM,MAAM,GAAGrC,KAAK,CAACsC,WAAN,CAAkB,MAAM;AACrC,QAAId,MAAM,CAACe,OAAX,EAAoB;AAClBf,MAAAA,MAAM,CAACe,OAAP,CAAetB,WAAf;AACA,aAAO,IAAP;AACD;;AACD,WAAO,KAAP;AACD,GANc,EAMZ,EANY,CAAf;AAQA,MAAMuB,iBAAiB,GAAGjB,SAAH,WAAGA,SAAH,GAAgB,EAAvC;AAEAjB,EAAAA,mBAAmB,CAAC,MAAM;AACxB,QAAIoB,YAAY,CAACa,OAAb,IAAwBZ,UAAU,CAACY,OAAvC,EAAgD;AAC9Cf,MAAAA,MAAM,CAACe,OAAP,GAAiBtC,YAAY,CAACyB,YAAY,CAACa,OAAd,EAAuBZ,UAAU,CAACY,OAAlC,EAA2C;AACtE5B,QAAAA,SAAS,EAAEkB,iBAD2D;AAEtEY,QAAAA,QAAQ,EAAEzB,KAAK,GAAG,OAAH,GAAa,UAF0C;AAGtEO,QAAAA,SAAS,EAAE,CACT;AACEmB,UAAAA,IAAI,EAAE,gBADR;AAEEC,UAAAA,OAAO,EAAErB;AAFX,SADS,EAKT;AACEoB,UAAAA,IAAI,EAAE,aADR;AAEEC,UAAAA,OAAO,EAAE;AAFX,SALS,EAST;AACED,UAAAA,IAAI,EAAE,MADR;AAEEC,UAAAA,OAAO,EAAEzB,IAFX;AAGE0B,UAAAA,OAAO,EAAE;AAAEC,YAAAA,OAAO,EAAE;AAAX;AAHX,SATS,EAcT;AACEH,UAAAA,IAAI,EAAE,eADR;AAEEE,UAAAA,OAAO,EAAE;AAAEE,YAAAA,eAAe,EAAE,KAAnB;AAA0BC,YAAAA,QAAQ,EAAE;AAApC;AAFX,SAdS,EAkBT;AACEL,UAAAA,IAAI,EAAE,QADR;AAEEE,UAAAA,OAAO,EAAE;AAAE/B,YAAAA;AAAF;AAFX,SAlBS,EAsBT;AACE6B,UAAAA,IAAI,EAAE,iBADR;AAEEC,UAAAA,OAAO,EAAE5B,eAFX;AAGE6B,UAAAA,OAAO,EAAE;AACPI,YAAAA,YAAY,EAAE;AAAA;;AAAA,qBAAM,sBAAApB,QAAQ,CAACW,OAAT,uCAAkBU,WAAlB,KAAiC,CAAvC;AAAA;AADP;AAHX,SAtBS,EA6BT;AACEP,UAAAA,IAAI,EAAE,OADR;AAEEC,UAAAA,OAAO,EAAEO,OAAO,CAACtB,QAAQ,CAACW,OAAV,CAFlB;AAGEK,UAAAA,OAAO,EAAE;AAAEO,YAAAA,OAAO,EAAEvB,QAAQ,CAACW;AAApB;AAHX,SA7BS,EAkCT;AACEG,UAAAA,IAAI,EAAE,aADR;AAEEU,UAAAA,KAAK,EAAE,OAFT;AAGET,UAAAA,OAAO,EAAE,IAHX;;AAIEU,UAAAA,EAAE,OAAY;AAAA,gBAAX;AAAEC,cAAAA;AAAF,aAAW;AACZtB,YAAAA,YAAY,CAACsB,KAAK,CAAC3C,SAAP,CAAZ;AACAuB,YAAAA,gBAAgB,CAACoB,KAAK,CAACC,MAAN,CAAa/B,MAAd,CAAhB;AACAY,YAAAA,cAAc,CAACkB,KAAK,CAACC,MAAN,CAAaC,KAAd,CAAd;AACD;;AARH,SAlCS,EA4CT,GAAGhB,iBA5CM;AAH2D,OAA3C,CAA7B;AAkDD;;AACD,WAAO,MAAM;AACX,UAAIhB,MAAM,CAACe,OAAX,EAAoB;AAClBf,QAAAA,MAAM,CAACe,OAAP,CAAekB,OAAf;AACAjC,QAAAA,MAAM,CAACe,OAAP,GAAiB,IAAjB;AACD;AACF,KALD,CArDwB,CA2DxB;AACD,GA5DkB,EA4DhB,CACDV,iBADC,EAEDb,KAFC,EAGDC,WAHC,EAIDC,IAJC,EAKDL,MALC,EAMDE,eANC,EAODO,aAPC,CA5DgB,CAAnB;AAsEAhB,EAAAA,mBAAmB,CAAC,MAAM;AACxB,QAAMoD,EAAE,GAAGC,qBAAqB,CAAC,MAAM;AACrC,UAAI1C,WAAJ,EAAiB;AAAA;;AACf,2BAAAO,MAAM,CAACe,OAAP,qCAAgBtB,WAAhB;AACD;AACF,KAJ+B,CAAhC;AAKA,WAAO,MAAM;AACX2C,MAAAA,oBAAoB,CAACF,EAAD,CAApB;AACD,KAFD;AAGD,GATkB,EAShB,CAACzC,WAAD,CATgB,CAAnB;;AAWA,MAAM4C,mBAAwC,gBACzC1B,WADyC,EAEzCjC,cAAc,CAACS,SAAD,EAAYQ,SAAZ,EAAuBC,gBAAvB,CAF2B,CAA9C;;AAKA,SAAO;AACL0C,IAAAA,cAAc,EAAEtC,MAAM,CAACe,OADlB;AAELwB,IAAAA,SAAS,EAAE;AACTC,MAAAA,GAAG,EAAEtC;AADI,KAFN;AAKLF,IAAAA,MAAM,EAAE;AACNwC,MAAAA,GAAG,EAAErC,UADC;AAENsC,MAAAA,KAAK,eACAhC,aADA;AAEHiC,QAAAA,eAAe,EAAE/D,iBAAiB,CAACQ,SAAD;AAF/B;AAFC,KALH;AAYL6C,IAAAA,KAAK,EAAE;AACLQ,MAAAA,GAAG,EAAEpC,QADA;AAELqC,MAAAA,KAAK,EAAEJ;AAFF,KAZF;AAgBLxB,IAAAA,MAhBK;AAiBL1B,IAAAA,SAjBK;AAkBLmB,IAAAA;AAlBK,GAAP;AAoBD","sourcesContent":["import * as React from \"react\"\nimport { Instance, createPopper, Modifier } from \"@popperjs/core\"\nimport type { Placement } from \"@popperjs/core\"\nimport { getArrowStyles, toTransformOrigin } from \"./popper.utils\"\n\nconst isBrowser = typeof window !== \"undefined\"\nconst useSafeLayoutEffect = isBrowser ? React.useLayoutEffect : React.useEffect\n\nexport type { Placement }\n\nexport interface UsePopperProps {\n  gutter?: number\n  placement?: Placement\n  offset?: number\n  preventOverflow?: boolean\n  fixed?: boolean\n  forceUpdate?: boolean\n  flip?: boolean\n  arrowSize?: number\n  arrowShadowColor?: string\n  eventsEnabled?: boolean\n  modifiers?: Modifier<any, any>[]\n}\n\nexport function usePopper(props: UsePopperProps = {}) {\n  const {\n    placement: initialPlacement = \"bottom\",\n    offset: offsetProp,\n    preventOverflow = true,\n    fixed = false,\n    forceUpdate = true,\n    flip = true,\n    arrowSize = 10,\n    arrowShadowColor,\n    gutter = arrowSize,\n    eventsEnabled = true,\n    modifiers,\n  } = props\n\n  const popper = React.useRef<Instance | null>(null)\n  const referenceRef = React.useRef<HTMLButtonElement>(null)\n  const popoverRef = React.useRef<HTMLDivElement>(null)\n  const arrowRef = React.useRef<HTMLDivElement>(null)\n\n  const [originalPlacement, place] = React.useState(initialPlacement)\n  const [placement, setPlacement] = React.useState(initialPlacement)\n  const [offset] = React.useState(offsetProp || [0, gutter])\n  const [popoverStyles, setPopoverStyles] = React.useState<React.CSSProperties>(\n    {},\n  )\n  const [arrowStyles, setArrowStyles] = React.useState<React.CSSProperties>({})\n\n  const update = React.useCallback(() => {\n    if (popper.current) {\n      popper.current.forceUpdate()\n      return true\n    }\n    return false\n  }, [])\n\n  const modifiersOverride = modifiers ?? []\n\n  useSafeLayoutEffect(() => {\n    if (referenceRef.current && popoverRef.current) {\n      popper.current = createPopper(referenceRef.current, popoverRef.current, {\n        placement: originalPlacement,\n        strategy: fixed ? \"fixed\" : \"absolute\",\n        modifiers: [\n          {\n            name: \"eventListeners\",\n            enabled: eventsEnabled,\n          },\n          {\n            name: \"applyStyles\",\n            enabled: false,\n          },\n          {\n            name: \"flip\",\n            enabled: flip,\n            options: { padding: 8 },\n          },\n          {\n            name: \"computeStyles\",\n            options: { gpuAcceleration: false, adaptive: false },\n          },\n          {\n            name: \"offset\",\n            options: { offset },\n          },\n          {\n            name: \"preventOverflow\",\n            enabled: preventOverflow,\n            options: {\n              tetherOffset: () => arrowRef.current?.clientWidth || 0,\n            },\n          },\n          {\n            name: \"arrow\",\n            enabled: Boolean(arrowRef.current),\n            options: { element: arrowRef.current },\n          },\n          {\n            name: \"updateState\",\n            phase: \"write\",\n            enabled: true,\n            fn({ state }) {\n              setPlacement(state.placement)\n              setPopoverStyles(state.styles.popper as React.CSSProperties)\n              setArrowStyles(state.styles.arrow as React.CSSProperties)\n            },\n          },\n          ...modifiersOverride,\n        ],\n      })\n    }\n    return () => {\n      if (popper.current) {\n        popper.current.destroy()\n        popper.current = null\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    originalPlacement,\n    fixed,\n    forceUpdate,\n    flip,\n    offset,\n    preventOverflow,\n    eventsEnabled,\n  ])\n\n  useSafeLayoutEffect(() => {\n    const id = requestAnimationFrame(() => {\n      if (forceUpdate) {\n        popper.current?.forceUpdate()\n      }\n    })\n    return () => {\n      cancelAnimationFrame(id)\n    }\n  }, [forceUpdate])\n\n  const computedArrowStyles: React.CSSProperties = {\n    ...arrowStyles,\n    ...getArrowStyles(placement, arrowSize, arrowShadowColor),\n  }\n\n  return {\n    popperInstance: popper.current,\n    reference: {\n      ref: referenceRef,\n    },\n    popper: {\n      ref: popoverRef,\n      style: {\n        ...popoverStyles,\n        transformOrigin: toTransformOrigin(placement),\n      },\n    },\n    arrow: {\n      ref: arrowRef,\n      style: computedArrowStyles,\n    },\n    update,\n    placement,\n    place,\n  }\n}\n\nexport type UsePopperReturn = ReturnType<typeof usePopper>\n"],"file":"use-popper.js"}